"use strict";define(function(t,e){var r=t("ajax").Ajax,n=function(t){this.defaults={result_template:"<a href='{{link}}' class='searchResult'>{{title}}</a>",info_template:"<h4>找到{{amount}}篇相关的文章</h4>",rss:"/rss"};var e=this.extend({},this.defaults,t);e.inputbox&&this.init(e)};n.prototype.extend=function(){for(var t=Array.prototype.slice.call(arguments),e=t.length-1;e>0;e--){var r=t[e-1],n=t[e];for(j in n)r[j]=n[j]}return t[0]},n.prototype.init=function(t){this.result_template=t.result_template,this.info_template=t.info_template,this.target=t.target,this.rss=t.rss,this.inputbox=t.inputbox,this.blogData=[],this.ajax=new r,this.loadRss()},n.prototype.loadRss=function(){if(this.inited)return!1;var t=(this.index,this.rss),e=(this.blogData,this);this.ajax.get(t,function(t){e.parseXML(t,function(t){var r=t.getElementsByTagName("item");r=Array.prototype.slice.call(r),r=r.map(function(t){return"function"!=typeof t?t:void 0}),e.items=r,e.inited=!0,e.listen()})})},n.prototype.parseXML=function(t,e){var r=null;if(!window.DOMParser&&window.ActiveXObject)for(var n=["MSXML.2.DOMDocument.6.0","MSXML.2.DOMDocument.3.0","Microsoft.XMLDOM"],i=0;i<n.length;i++)try{r=new ActiveXObject(n[i]),r.async=!1,r.loadXML(t);break}catch(a){}else{if(!(window.DOMParser&&document.implementation&&document.implementation.createDocument))return null;try{domParser=new DOMParser,r=domParser.parseFromString(t,"text/xml")}catch(a){}}return e&&e(r),r},n.prototype.listen=function(){var t=this;this.inputbox.onkeyup=function(){var e=t.inputbox;if(!e.value)return t.target.innerHTML="";var r=t.search(e.value),n=t.format(t.info_template,{amount:r.length}),a=n;for(i in r)a+=t.format(t.result_template,r[i]);t.target.innerHTML=a}},n.prototype.format=function(t,e){return t.replace(/{{([^{}]*)}}/g,function(t,r){var n=e[r];return"string"==typeof n||"number"==typeof n?n:t})},n.prototype.search=function(t){var e=[],r=new RegExp(t.toLowerCase());return this.items.forEach(function(n){var i=n.getElementsByTagName("description")[0].firstChild.data.replace(/<!((\[)?\[)|(\]\]>)/g,"").replace(/<[^>]*>/g,""),a=n.getElementsByTagName("title")[0].firstChild.data.replace(/<!((\[)?CDATA\[)|(\]\]>)/g,"");if(r.test(a.toLowerCase()+i.toLowerCase())){var o=n.getElementsByTagName("link")[0].firstChild.data;e.push({keyword:t,title:a,link:o,content:i})}}),e},e.GhostBot=n});